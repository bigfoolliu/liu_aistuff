# 数据库介绍

<!-- vim-markdown-toc Marked -->

* [1.概述](#1.概述)
* [2.分类](#2.分类)
    - [2.1关系型数据库](#2.1关系型数据库)
    - [2.2非关系型数据库](#2.2非关系型数据库)
* [3.数据库连接池](#3.数据库连接池)
    - [3.1概述](#3.1概述)
    - [3.2工作原理](#3.2工作原理)
    - [3.3注意事项](#3.3注意事项)

<!-- vim-markdown-toc -->

## 1.概述

## 2.分类

### 2.1关系型数据库

结构化数据集，由行和列组合而成的二维表结构的数据。

- DB2
- Oracle
- MySQL
- SQL server

### 2.2非关系型数据库

键值对形式的非结构化数据集，例如用户的聊天记录、拍摄的图片、录制的视频等等。

- MongoDB
- Redis

## 3.数据库连接池

### 3.1概述

- 数据库连接池是`负责分配、管理和释放数据库连接`
- 允许应用程序`重复使用一个现有的数据库连接`，而不是再重新建立一个, 减少资源消耗
- 基本思路是：在应用程序启动的时候建立足够多的数据库连接，并将这些连接组成一个连接池，之后动态的从池中申请，使用和释放数据库连接, 多于连接池中连接数的并发请求，则排队等待

**不使用数据库连接池的步骤：**

1. TCP建立连接的三次握手
2. MySQL认证的三次握手
3. 真正的SQL执行
4. MySQL的关闭
5. TCP的四次握手关闭


### 3.2工作原理

1. 连接池的建立
    系统初始化的时候根据配置建立池并在其中建立几个连接对象，连接池中的连接对象不轻易创建和关闭
2. 连接池的管理，管理策略为：
    - 客户请求数据库连接时，首先查看连接池中是否有空闲连接，如果存在空闲连接，则将连接分配给客户使用；
    - 如果没有空闲连接，则查看当前所开的连接数是否已经达到最大连接数,
        - 如果没达到就重新创建一个连接给请求的客户；
        - 如果达到就按设定的最大等待时间进行等待，如果超出最大等待时间，则抛出异常给客户。
    - 当客户释放数据库连接时，先判断该连接的引用次数是否超过了规定值，如果超过就从连接池中删除该连接，否则保留为其他客户服务
3. 连接池的关闭
    当应用程序退出时，关闭连接池中所有的连接，释放连接池相关的资源

### 3.3注意事项

1. 并发问题, 需要考虑多线程,`确保线程同步`
2. 事务处理, 多个线程共用一个connection对象且有事务的时候，无法确定数据库操作对应的事务，因此可以`让每一个事务来独占一个连接`
3. 连接池的分配和释放，连接和释放很影响性能，对于连接的管理可使用一个List。即`把已经创建的连接都放入List中去统一管理`。每当用户请求一个连接时，系统检查这个List中有没有可以分配的连接。如果有就把那个最合适的连接分配给他，如果没有就抛出一个异常给用户。
4. 连接池的配置和维护，可采取设置最小连接数（minConnection）和最大连接数（maxConnection）等参数来控制连接池中的连接, 可以在开发时候设置较小值，加快启动速度，实际使用的时候设置较大值，访问时候速度会块，`具体的值则取决于访问量`

