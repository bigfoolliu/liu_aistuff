# CI与CD

<!-- vim-markdown-toc Marked -->

* [1.持续集成相关概念](#1.持续集成相关概念)
    - [1.1CI](#1.1ci)
    - [1.2CD](#1.2cd)
    - [1.3CD](#1.3cd)
* [2.流程](#2.流程)

<!-- vim-markdown-toc -->

## 1.相关概念

### 1.1CI

- `持续集成(Continuous integration)`
- 频繁将`代码集成到主干`,目的是让产品可以快速迭代，同时还能保持高质量。
- 核心措施是：代码集成到主干之前，必须通过自动化测试。只要有一个测试用例失败，就不能集成。

优势:

1. 提高开发效率
2. 快速发现并定位bug
3. 快速的发布更新

### 1.2CD

- `持续交付(Continuous delivery)`
- 频繁地将软件的新版本，交付给质量团队或者用户，以供评审。如果评审通过，代码就进入生产阶段

### 1.3CD

- `持续部署(Continuous deployment)`
- 代码通过评审以后，自动部署到生产环境

## 2.流程

根据持续集成的设计，代码从提交到生产，整个过程有以下几步：

1. 提交，仓库提交代码
2. 测试（第一轮），代码仓库对commit操作配置了钩子（hook），只要提交代码或者合并进主干，就会跑自动化测试（包括`单元测试`，`集成测试`，`端对端测试`）,第一轮至少要跑单元测试
3. 通过第一轮测试，代码合并到主干，就算可以交付了，交付后，先进行`构建（build,源码转换为可以运行的实际代码，常用的构建工具为Jenkins, Travis, Codeship, Strider）`，再进行第二轮测试
4. 第二轮测试是全面测试，包括单元测试和集成测试，所有测试以自动化为主，少数无法自动化的测试用例，要人工跑
5. 部署，通过了第二轮测试，当前代码就是一个可以`直接部署的版本（artifact）`, 将所有文件打包存档，发到生产服务器，其将打包文件解包，然后重启应用，部署工具有`Ansible，Chef，Puppet等`
6. 一旦当前版本发生问题，就要回滚到上一个版本的构建结果
