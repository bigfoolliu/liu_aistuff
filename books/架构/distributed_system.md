# 分布式系统

<!-- TOC -->

- [分布式系统](#分布式系统)
    - [1.概念](#1概念)
        - [1.1分布式和集群的区别](#11分布式和集群的区别)
        - [1.2进程间通信](#12进程间通信)
        - [1.3分布式编程范型](#13分布式编程范型)
        - [1.4间接通信](#14间接通信)
        - [1.5分布式文件系统](#15分布式文件系统)
        - [1.6事务和并发控制](#16事务和并发控制)
    - [2.分布式系统原理](#2分布式系统原理)
        - [2.1数据分布方式](#21数据分布方式)
        - [2.2系统模型](#22系统模型)
    - [3.间接通信的相关技术](#3间接通信的相关技术)
    - [交换模式](#交换模式)

<!-- /TOC -->

## 1.概念

组件分布在联网的计算机上，组件之间通过传递消息进行通信和动作协调的系统。

分布式系统的特征：

- 并发
- 缺乏全局时钟
- 故障独立性

1. 节点，一个可以独立按照分布式协议完成一组逻辑的程序个体
2. 通信，节点与节点之间完全独立，其通过一个不可靠的网络通信
3. 存储，节点可以通过将数据写入节点在同一台机器的本地存储设备保存数据
4. 异常
   1. 机器宕机
   2. 网络异常、
      1. 消息丢失
      2. 消息乱序
      3. 数据错误
      4. 不可靠的TCP
5. 分布式系统`三态`
   1. 成功
   2. 失败
   3. 超时
6. 副本，分布式系统中为数据或服务提供的冗余

### 1.1分布式和集群的区别

分布式:一个复杂业务分拆多个子业务,部署在不同的服务器上.
集群:同一个业务,部署在多个服务器上.
集群是个物理形态,分布式是个工作方式
集群一般是物理集中、统一管理的,而分布式系统则不强调这一点.

衡量分布式系统的指标：

1. 性能
2. 可用性
3. 可扩展性
4. 一致性

### 1.2进程间通信

`同步通信`：发送进程和接收进程在每个消息上同步，`send`和`receive`都是阻塞操作，每次发出一个send操作之后，发送进程或线程将一直阻塞，直至发送了相应的receive操作为止。

`异步通信`：send的操作是非阻塞的，只要消息被复制到本地缓冲区，发送进程就可以继续进行其他处理，消息的传递和发送进程并行进行。

### 1.3分布式编程范型

1. 请求-应答协议
2. 远程方法调用
3. 远程过程调用

### 1.4间接通信

分布式系统中实体通过中介者进行通信，没有发送者和接受者之间的直接耦合。

空间解耦：发送者不知道也不需要知道接收者的身份。

时间解耦：发送者和接受者有独立的生命周期。

### 1.5分布式文件系统

文件系统负责文件的组织，存储，检索，命名，共享和保护。

### 1.6事务和并发控制

`事务`定义了一个服务器操作序列，由服务器保证这些操作序列在多个客户并发访问和服务器出现故障情况下的原子性。

`并发控制`基于串行相等的标准，几种方式：

1. `锁`，当多个事务访问同一个对象时根据这些操作访问同一对象的先后次序给事务排序
2. `乐观并发控制`，允许事务一直执行，直到它们准备提交为止，只是在提交时通过检查来确定已执行的操作是否存在冲突
3. `时间戳排序`，利用时间戳将访问同一对象的事务根据它们的起始时间进行排序

## 2.分布式系统原理

### 2.1数据分布方式

即数据拆解问题，输入的数据拆解为分布式系统的能用的数据。

1. 哈希方式
   按照数据的某一个特征计算哈希值，并将哈希值与机器中机器建立映射关系，从而将不同的哈希值的数据分布到不同的机器上。
   一种常见的哈希方式是按数据属于的用户 id 计算哈希值，集群中的服务器按 0 到机器数减 1 编号，哈希值除以服务器的个数，结果的余数作为处理该数据的服务器编号。
   可扩展性不高，一旦某数据特征值的数据严重不均，容易出现“数据倾斜”问题。
2. 按数据范围分布
3. 按数据量分布
4. 一致性哈希
5. 副本与数据分布

### 2.2系统模型

1. 物理模型，组成计算机系统的计算机和设备的互连
2. 体系结构模型，比如：客户-服务器和对等模型
3. 基础模型

## 3.间接通信的相关技术

1. 组通信
2. 发布-订阅系统
3. 消息队列
4. 元组空间
5. 分布式共享内存

## 交换模式

两个节点之间传输信息的交换方式。

1. 广播
2. 电路交换
3. 包交换
4. 帧中继
